# PR Visual with Gemini CLI - Agentic codebase exploration
#
# This workflow lets Gemini CLI explore your codebase to understand the PR,
# then generates a visual based on that understanding.
#
# Better for: Complex PRs where raw diffs lack context

name: PR Visual (Agentic)

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  visualize:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Step 1: Let Gemini CLI explore the codebase and understand the PR
      - name: Understand PR with Gemini CLI
        id: understand
        uses: google-github-actions/run-gemini-cli@v1
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          prompt: |
            You are a creative director preparing a brief for an infographic designer.

            Explore this PR's changes. Read any files you need to fully understand:
            - What problem does this PR solve?
            - What's the key change or insight?
            - How does it fit into the broader codebase?

            Then write a creative brief for generating a visual infographic.

            Guidelines for the brief:
            - Scale complexity to the change (small fix = simple visual)
            - Focus on the ONE key insight, not every detail
            - Prefer clarity over comprehensiveness
            - A single compelling diagram beats 5 dense sections

            Output ONLY the creative brief, no preamble.

      # Step 2: Generate the visual from the brief
      - name: Generate PR Visual
        uses: gitethanwoo/pr-visual@v1
        with:
          gemini-api-key: ${{ secrets.GEMINI_API_KEY }}
          prompt: ${{ steps.understand.outputs.summary }}
          style: clean  # or: excalidraw, minimal, tech, playful
